{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useCallback, useState } from \"react\";\nimport { io } from 'socket.io-client';\nimport toast from 'react-hot-toast';\nconst SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:3001';\nexport const useSocket = userId => {\n  _s();\n  const socketRef = useRef(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [serverTimeOffset, setServerTimeOffset] = useState(0);\n  const listenersRef = useRef({});\n  useEffect(() => {\n    if (!userId) return;\n    const socket = io(SOCKET_URL, {\n      transports: ['websocket', 'polling'],\n      reconnection: true,\n      reconnectionDelay: 1000,\n      reconnectionAttempts: 5\n    });\n    socketRef.current = socket;\n    socket.on('connect', () => {\n      console.log('Connected to auction server');\n      setIsConnected(true);\n      toast.success('Connected to live auction', {\n        icon: 'ðŸ”—',\n        duration: 2000\n      });\n    });\n    socket.on('disconnect', () => {\n      console.log('Disconnected to auction server');\n      setIsConnected(false);\n      toast.error('Connection lost. Reconnecting...', {\n        icon: 'âš ï¸',\n        duration: 3000\n      });\n    });\n    socket.on('SERVER_TIME', ({\n      serverTime\n    }) => {\n      const clientTime = Date.now();\n      const offset = serverTime - clientTime;\n      setServerTimeOffset(offset);\n      console.log('Time synced. Offset:', offset, 'ms');\n    });\n    socket.on('UPDATE_BID', data => {\n      if (listenersRef.current.onBidUpdate) {\n        listenersRef.current.onBidUpdate(data);\n      }\n    });\n    socket.on('BID_ERROR', data => {\n      if (listenersRef.current.onBidError) {\n        listenersRef.current.onBidError(data);\n      }\n    });\n    socket.on('BID_SUCCESS', data => {\n      if (listenersRef.current.onBidSuccess) {\n        listenersRef.current.onBidSuccess(data);\n      }\n    });\n    socket.on('ITEMS_UPDATED', data => {\n      if (listenersRef.current.onItemsUpdate) {\n        listenersRef.current.onItemsUpdate(data);\n      }\n    });\n    return () => {\n      socket.disconnect();\n      socketRef.current = null;\n      setIsConnected(false);\n    };\n  }, [userId]);\n  const placeBid = useCallback((itemId, bidAmount) => {\n    if (!socketRef.current || !isConnected) {\n      toast.error('Not connected to server');\n      return;\n    }\n    socketRef.current.emit('BID_PLACED', {\n      itemId,\n      bidAmount,\n      userId\n    });\n  }, [isConnected, userId]);\n  const on = useCallback((event, callback) => {\n    listenersRef.current[event] = callback;\n  }, []);\n  const off = useCallback(event => {\n    delete listenersRef.current[event];\n  }, []);\n  const getServerTime = useCallback(() => {\n    return Date.now() + serverTimeOffset;\n  }, [serverTimeOffset]);\n  return {\n    placeBid,\n    on,\n    off,\n    isConnected,\n    getServerTime,\n    serverTimeOffset\n  };\n};\n_s(useSocket, \"T/35kgvGn/Trsgz7h5vlBHX002M=\");","map":{"version":3,"names":["useEffect","useRef","useCallback","useState","io","toast","SOCKET_URL","process","env","REACT_APP_SOCKET_URL","useSocket","userId","_s","socketRef","isConnected","setIsConnected","serverTimeOffset","setServerTimeOffset","listenersRef","socket","transports","reconnection","reconnectionDelay","reconnectionAttempts","current","on","console","log","success","icon","duration","error","serverTime","clientTime","Date","now","offset","data","onBidUpdate","onBidError","onBidSuccess","onItemsUpdate","disconnect","placeBid","itemId","bidAmount","emit","event","callback","off","getServerTime"],"sources":["C:/Users/kunal/Desktop/auction platform/frontend/src/hooks/useSocket.js"],"sourcesContent":["import { useEffect, useRef, useCallback, useState } from \"react\";\r\nimport { io } from 'socket.io-client';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:3001';\r\n\r\nexport const useSocket = (userId) => {\r\n\r\n    const socketRef = useRef(null);\r\n    const [isConnected, setIsConnected] = useState(false);\r\n    const [serverTimeOffset, setServerTimeOffset] = useState(0);\r\n    const listenersRef = useRef({});\r\n\r\n    useEffect(() => {\r\n        if (!userId) return;\r\n\r\n        const socket = io(SOCKET_URL, {\r\n            transports: ['websocket', 'polling'],\r\n            reconnection: true,\r\n            reconnectionDelay: 1000,\r\n            reconnectionAttempts: 5\r\n        });\r\n\r\n        socketRef.current = socket;\r\n    \r\n\r\n    socket.on('connect', () => {\r\n        console.log('Connected to auction server');\r\n        setIsConnected(true);\r\n        toast.success('Connected to live auction', {\r\n            icon: 'ðŸ”—',\r\n            duration: 2000    \r\n        });\r\n    });\r\n\r\n    socket.on('disconnect', () => {\r\n        console.log('Disconnected to auction server');\r\n        setIsConnected(false);\r\n        toast.error('Connection lost. Reconnecting...', {\r\n            icon: 'âš ï¸',\r\n            duration: 3000    \r\n        });\r\n    });\r\n\r\n    socket.on('SERVER_TIME', ({ serverTime }) => {\r\n        const clientTime = Date.now();\r\n        const offset = serverTime - clientTime;\r\n        setServerTimeOffset(offset);\r\n        console.log('Time synced. Offset:', offset, 'ms');\r\n    })\r\n\r\n    socket.on('UPDATE_BID', (data) => {\r\n        if(listenersRef.current.onBidUpdate) {\r\n            listenersRef.current.onBidUpdate(data);\r\n        }\r\n    });\r\n\r\n      socket.on('BID_ERROR', (data) => {\r\n        if(listenersRef.current.onBidError) {\r\n            listenersRef.current.onBidError(data);\r\n        }\r\n    });\r\n\r\n      socket.on('BID_SUCCESS', (data) => {\r\n        if(listenersRef.current.onBidSuccess) {\r\n            listenersRef.current.onBidSuccess(data);\r\n        }\r\n    });\r\n\r\n      socket.on('ITEMS_UPDATED', (data) => {\r\n        if(listenersRef.current.onItemsUpdate) {\r\n            listenersRef.current.onItemsUpdate(data);\r\n        }\r\n    });\r\n\r\n    return () => {\r\n        socket.disconnect();\r\n        socketRef.current = null;\r\n        setIsConnected(false);\r\n      };\r\n    }, [userId])\r\n\r\n    const placeBid = useCallback((itemId, bidAmount) => {\r\n        if (!socketRef.current || !isConnected) {\r\n            toast.error('Not connected to server');\r\n            return;\r\n        }\r\n\r\n        socketRef.current.emit('BID_PLACED', {\r\n            itemId,\r\n            bidAmount,\r\n            userId\r\n        });\r\n    }, [isConnected, userId]);\r\n\r\n    const on = useCallback((event, callback) => {\r\n        listenersRef.current[event] = callback;\r\n    }, []);\r\n\r\n    const off = useCallback((event) => {\r\n        delete listenersRef.current[event];\r\n    }, []);\r\n\r\n    const getServerTime = useCallback(() => {\r\n        return Date.now() + serverTimeOffset;\r\n    }, [serverTimeOffset]);\r\n\r\n    return {\r\n        placeBid,\r\n        on,\r\n        off,\r\n        isConnected,\r\n        getServerTime,\r\n        serverTimeOffset\r\n    };  \r\n};"],"mappings":";AAAA,SAASA,SAAS,EAAEC,MAAM,EAAEC,WAAW,EAAEC,QAAQ,QAAQ,OAAO;AAChE,SAASC,EAAE,QAAQ,kBAAkB;AACrC,OAAOC,KAAK,MAAM,iBAAiB;AAEnC,MAAMC,UAAU,GAAGC,OAAO,CAACC,GAAG,CAACC,oBAAoB,IAAI,uBAAuB;AAE9E,OAAO,MAAMC,SAAS,GAAIC,MAAM,IAAK;EAAAC,EAAA;EAEjC,MAAMC,SAAS,GAAGZ,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAM,CAACa,WAAW,EAAEC,cAAc,CAAC,GAAGZ,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACa,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGd,QAAQ,CAAC,CAAC,CAAC;EAC3D,MAAMe,YAAY,GAAGjB,MAAM,CAAC,CAAC,CAAC,CAAC;EAE/BD,SAAS,CAAC,MAAM;IACZ,IAAI,CAACW,MAAM,EAAE;IAEb,MAAMQ,MAAM,GAAGf,EAAE,CAACE,UAAU,EAAE;MAC1Bc,UAAU,EAAE,CAAC,WAAW,EAAE,SAAS,CAAC;MACpCC,YAAY,EAAE,IAAI;MAClBC,iBAAiB,EAAE,IAAI;MACvBC,oBAAoB,EAAE;IAC1B,CAAC,CAAC;IAEFV,SAAS,CAACW,OAAO,GAAGL,MAAM;IAG9BA,MAAM,CAACM,EAAE,CAAC,SAAS,EAAE,MAAM;MACvBC,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAC;MAC1CZ,cAAc,CAAC,IAAI,CAAC;MACpBV,KAAK,CAACuB,OAAO,CAAC,2BAA2B,EAAE;QACvCC,IAAI,EAAE,IAAI;QACVC,QAAQ,EAAE;MACd,CAAC,CAAC;IACN,CAAC,CAAC;IAEFX,MAAM,CAACM,EAAE,CAAC,YAAY,EAAE,MAAM;MAC1BC,OAAO,CAACC,GAAG,CAAC,gCAAgC,CAAC;MAC7CZ,cAAc,CAAC,KAAK,CAAC;MACrBV,KAAK,CAAC0B,KAAK,CAAC,kCAAkC,EAAE;QAC5CF,IAAI,EAAE,IAAI;QACVC,QAAQ,EAAE;MACd,CAAC,CAAC;IACN,CAAC,CAAC;IAEFX,MAAM,CAACM,EAAE,CAAC,aAAa,EAAE,CAAC;MAAEO;IAAW,CAAC,KAAK;MACzC,MAAMC,UAAU,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;MAC7B,MAAMC,MAAM,GAAGJ,UAAU,GAAGC,UAAU;MACtChB,mBAAmB,CAACmB,MAAM,CAAC;MAC3BV,OAAO,CAACC,GAAG,CAAC,sBAAsB,EAAES,MAAM,EAAE,IAAI,CAAC;IACrD,CAAC,CAAC;IAEFjB,MAAM,CAACM,EAAE,CAAC,YAAY,EAAGY,IAAI,IAAK;MAC9B,IAAGnB,YAAY,CAACM,OAAO,CAACc,WAAW,EAAE;QACjCpB,YAAY,CAACM,OAAO,CAACc,WAAW,CAACD,IAAI,CAAC;MAC1C;IACJ,CAAC,CAAC;IAEAlB,MAAM,CAACM,EAAE,CAAC,WAAW,EAAGY,IAAI,IAAK;MAC/B,IAAGnB,YAAY,CAACM,OAAO,CAACe,UAAU,EAAE;QAChCrB,YAAY,CAACM,OAAO,CAACe,UAAU,CAACF,IAAI,CAAC;MACzC;IACJ,CAAC,CAAC;IAEAlB,MAAM,CAACM,EAAE,CAAC,aAAa,EAAGY,IAAI,IAAK;MACjC,IAAGnB,YAAY,CAACM,OAAO,CAACgB,YAAY,EAAE;QAClCtB,YAAY,CAACM,OAAO,CAACgB,YAAY,CAACH,IAAI,CAAC;MAC3C;IACJ,CAAC,CAAC;IAEAlB,MAAM,CAACM,EAAE,CAAC,eAAe,EAAGY,IAAI,IAAK;MACnC,IAAGnB,YAAY,CAACM,OAAO,CAACiB,aAAa,EAAE;QACnCvB,YAAY,CAACM,OAAO,CAACiB,aAAa,CAACJ,IAAI,CAAC;MAC5C;IACJ,CAAC,CAAC;IAEF,OAAO,MAAM;MACTlB,MAAM,CAACuB,UAAU,CAAC,CAAC;MACnB7B,SAAS,CAACW,OAAO,GAAG,IAAI;MACxBT,cAAc,CAAC,KAAK,CAAC;IACvB,CAAC;EACH,CAAC,EAAE,CAACJ,MAAM,CAAC,CAAC;EAEZ,MAAMgC,QAAQ,GAAGzC,WAAW,CAAC,CAAC0C,MAAM,EAAEC,SAAS,KAAK;IAChD,IAAI,CAAChC,SAAS,CAACW,OAAO,IAAI,CAACV,WAAW,EAAE;MACpCT,KAAK,CAAC0B,KAAK,CAAC,yBAAyB,CAAC;MACtC;IACJ;IAEAlB,SAAS,CAACW,OAAO,CAACsB,IAAI,CAAC,YAAY,EAAE;MACjCF,MAAM;MACNC,SAAS;MACTlC;IACJ,CAAC,CAAC;EACN,CAAC,EAAE,CAACG,WAAW,EAAEH,MAAM,CAAC,CAAC;EAEzB,MAAMc,EAAE,GAAGvB,WAAW,CAAC,CAAC6C,KAAK,EAAEC,QAAQ,KAAK;IACxC9B,YAAY,CAACM,OAAO,CAACuB,KAAK,CAAC,GAAGC,QAAQ;EAC1C,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMC,GAAG,GAAG/C,WAAW,CAAE6C,KAAK,IAAK;IAC/B,OAAO7B,YAAY,CAACM,OAAO,CAACuB,KAAK,CAAC;EACtC,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMG,aAAa,GAAGhD,WAAW,CAAC,MAAM;IACpC,OAAOgC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAGnB,gBAAgB;EACxC,CAAC,EAAE,CAACA,gBAAgB,CAAC,CAAC;EAEtB,OAAO;IACH2B,QAAQ;IACRlB,EAAE;IACFwB,GAAG;IACHnC,WAAW;IACXoC,aAAa;IACblC;EACJ,CAAC;AACL,CAAC;AAACJ,EAAA,CA7GWF,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}